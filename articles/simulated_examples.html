<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="inlamemi">
<title>Simulated examples â€¢ inlamemi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulated examples">
<meta property="og:description" content="inlamemi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">inlamemi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a>
    <a class="dropdown-item" href="../articles/Visualize_model_structure.html">How are the models structured?</a>
    <a class="dropdown-item" href="../articles/multiple_error_variables.html">Multiple variables with measurement error and missingness</a>
    <a class="dropdown-item" href="../articles/nhanes_survival.html">Survival data with repeated systolic blood pressure measurements</a>
    <a class="dropdown-item" href="../articles/simulated_examples.html">Simulated examples</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulated examples</h1>
            
      
      
      <div class="d-none name"><code>simulated_examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlamemi/">inlamemi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette shows how to fit measurement error and imputation
models using the <code>inlamemi</code> package for a few different
simple simulated data sets. Note that although the data sets describe
realistic situations, they are all completely fictitious, and created
purely to illustrate how to fit models in different situations.</p>
<div class="section level2">
<h2 id="simple-example-with-missingness-and-two-types-of-measurement-error">Simple example with missingness and two types of measurement
error<a class="anchor" aria-label="anchor" href="#simple-example-with-missingness-and-two-types-of-measurement-error"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Berkson, classical, missing values</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>This is a simple simulation with Berkson and classical error as well
as missing data, to check that the package works as expected in that
scenario.</p>
<div class="section level3">
<h3 id="generating-the-data">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Berkson error:</span></span>
<span><span class="va">u_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_b</span> <span class="co"># Turn off Berkson by commenting out "+ u_b"</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">simple_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple_data</span>, </span>
<span>                         formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, </span>
<span>                         formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>, </span>
<span>                         family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                         error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"berkson"</span>, <span class="st">"classical"</span><span class="op">)</span>,</span>
<span>                         prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,   <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>, <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, <span class="co"># N(0, 10^3)</span></span>
<span>                         initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "berkson"   "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode          kld</span></span>
<span><span class="co">#&gt; beta.0 1.040172 0.2200508  0.6210422 1.040985   1.463449 1.040174 5.064371e-07</span></span>
<span><span class="co">#&gt; beta.z 1.932117 0.3906046  1.2425798 1.932683   2.639673 1.934831 1.625492e-04</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for error prone variable: </span></span>
<span><span class="co">#&gt;            mean       sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 1.972915 0.199118   1.585744 1.971275   2.369734 1.964365</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.033054 0.05061261  0.9337593 1.033063    1.13230 1.033063</span></span>
<span><span class="co">#&gt; alpha.x.z 2.024765 0.05227544  1.9222868 2.024747    2.12735 2.024747</span></span>
<span><span class="co">#&gt;                    kld</span></span>
<span><span class="co">#&gt; alpha.x.0 3.280884e-11</span></span>
<span><span class="co">#&gt; alpha.x.z 5.655308e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean        sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.1222087 0.3649457  0.5552882 1.0723163</span></span>
<span><span class="co">#&gt; Precision for x berkson model   1.1288833 0.3507277  0.6003051 1.0757635</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9287213 0.1105046  0.7278495 0.9230255</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.9742048 0.1248290  0.7556712 0.9649510</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest   1.975534 0.9808094</span></span>
<span><span class="co">#&gt; Precision for x berkson model     1.966969 0.9757922</span></span>
<span><span class="co">#&gt; Precision for x classical model   1.162261 0.9133220</span></span>
<span><span class="co">#&gt; Precision for x imp model         1.246370 0.9441547</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"coefficient_name"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>, </span>
<span><span class="co">#  "beta.0",  beta.0, </span></span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span>, </span>
<span> <span class="co"># "alpha.0", alpha.0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simple_model</span>, plot_intercepts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="missing-data-only">Missing data only<a class="anchor" aria-label="anchor" href="#missing-data-only"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Missing values</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>In this example, we have missingness in one covariate, but no other
measurement error, so this shows how to do simple imputation of a
missing covariate in R-INLA.</p>
<div class="section level3">
<h3 id="generating-the-data-1">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-1"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without missingness:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate that will have missingness:</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">missing_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-without-imputation">Model without imputation<a class="anchor" aria-label="anchor" href="#model-without-imputation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, data <span class="op">=</span> <span class="va">missing_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span><span class="co">#&gt;                 mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; (Intercept) 2.059952 0.07313492  1.9165113 2.059952   2.203392 2.059952</span></span>
<span><span class="co">#&gt; x           1.060038 0.04847764  0.9649586 1.060038   1.155118 1.060038</span></span>
<span><span class="co">#&gt; z           4.242952 0.09766027  4.0514099 4.242952   4.434494 4.242952</span></span>
<span><span class="co">#&gt;                      kld</span></span>
<span><span class="co">#&gt; (Intercept) 1.017087e-11</span></span>
<span><span class="co">#&gt; x           1.010980e-11</span></span>
<span><span class="co">#&gt; z           1.015061e-11</span></span>
<span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.hyperpar</span></span>
<span><span class="co">#&gt;                                              mean         sd 0.025quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.3082829 0.01379352  0.2818484</span></span>
<span><span class="co">#&gt;                                         0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.308078  0.3359021 0.3076677</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-with-imputation">Model with imputation<a class="anchor" aria-label="anchor" href="#model-with-imputation"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>,</span>
<span>                            formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                            family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">missing_data</span>, </span>
<span>                            error_type <span class="op">=</span> <span class="st">"missing"</span>, </span>
<span>                            prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                            initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "missing"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; beta.0 0.9738221 0.04838904  0.8800636 0.9737039   1.068001 0.9736242</span></span>
<span><span class="co">#&gt; beta.z 1.9438691 0.07597616  1.7994888 1.9431997   2.089047 1.9426910</span></span>
<span><span class="co">#&gt;                 kld</span></span>
<span><span class="co">#&gt; beta.0 1.273243e-07</span></span>
<span><span class="co">#&gt; beta.z 8.144599e-07</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for error prone variable: </span></span>
<span><span class="co">#&gt;            mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.024727 0.03435893   1.956586 2.024897   2.091869 2.025609</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.031094 0.03136775  0.9695814 1.031091   1.092625 1.031091</span></span>
<span><span class="co">#&gt; alpha.x.z 1.983403 0.03206932  1.9205030 1.983403   2.046299 1.983403</span></span>
<span><span class="co">#&gt;                    kld</span></span>
<span><span class="co">#&gt; alpha.x.0 1.291964e-11</span></span>
<span><span class="co">#&gt; alpha.x.z 9.607760e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                     mean         sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.056388 0.05240982  0.9561164 1.055382</span></span>
<span><span class="co">#&gt; Precision for x classical model 1.144367 0.35693378  0.6357569 1.082190</span></span>
<span><span class="co">#&gt; Precision for x imp model       1.065845 0.04959495  0.9706441 1.065002</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest   1.162413 1.0540036</span></span>
<span><span class="co">#&gt; Precision for x classical model   2.022352 0.9578352</span></span>
<span><span class="co">#&gt; Precision for x imp model         1.165866 1.0639826</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"coefficient_name"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.0"</span>, <span class="va">beta.0</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>,</span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="va">alpha.0</span>,</span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">missing_truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="random-effect-in-the-main-model">Random effect in the main model<a class="anchor" aria-label="anchor" href="#random-effect-in-the-main-model"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left">
<span class="math inline">\(z\)</span>, random effect
<span class="math inline">\(w\)</span>
</td>
</tr></tbody>
</table>
<p>In this example, we simulate data that is grouped in such a way that
it should be modelled with a random effect in the model of interest.</p>
<div class="section level3">
<h3 id="generating-the-data-2">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-2"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># number of groups</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of observations per group</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">*</span><span class="va">n</span> <span class="co"># total number of observations</span></span>
<span></span>
<span><span class="va">sd_y</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># sd for the noise</span></span>
<span><span class="va">sd_w</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for random effect</span></span>
<span><span class="va">sd_x</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for covariate without error</span></span>
<span><span class="va">sd_u</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># sd for measurement error</span></span>
<span></span>
<span><span class="co"># Covariate without error</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate with error</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_x</span><span class="op">)</span> <span class="co"># Independent of z, but can change that here</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random effect</span></span>
<span><span class="va">w_per_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">0</span>, <span class="va">sd_w</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">w_per_group</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-1">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-1"></a>
</h3>
<p>Firstly, if we ignored the measurement error, we might fit a model
like this:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">naive_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time used:</span></span>
<span><span class="co">#&gt;     Pre = 0.192, Running = 0.278, Post = 0.022, Total = 0.492 </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">#&gt; (Intercept) -0.316 0.560     -1.429   -0.316      0.796 -0.316   0</span></span>
<span><span class="co">#&gt; x            1.682 0.051      1.582    1.682      1.782  1.682   0</span></span>
<span><span class="co">#&gt; z            2.022 0.058      1.908    2.022      2.136  2.022   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;   Name     Model</span></span>
<span><span class="co">#&gt;     id IID model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters:</span></span>
<span><span class="co">#&gt;                                          mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.077 0.003      0.070    0.077</span></span>
<span><span class="co">#&gt; Precision for id                        0.401 0.184      0.145    0.367</span></span>
<span><span class="co">#&gt;                                         0.975quant  mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations      0.084 0.077</span></span>
<span><span class="co">#&gt; Precision for id                             0.852 0.305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal log-Likelihood:  -2756.06 </span></span>
<span><span class="co">#&gt;  is computed </span></span>
<span><span class="co">#&gt; Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">#&gt; (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># curve(dgamma(x, shape = 1.5, rate = 2), to = 2)</span></span>
<span></span>
<span><span class="va">reff_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> </span>
<span>                         <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span>, hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="op">-</span><span class="fl">15</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                       initial.prec.moi <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, </span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z + f(id, model = "iid", hyper = list(prec = list(initial = -15, </span></span>
<span><span class="co">#&gt;     param = c(2, 2))))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;              mean         sd 0.025quant  0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; beta.0 -0.3672766 0.54874094  -1.458175 -0.367605   0.725884 -0.3675179</span></span>
<span><span class="co">#&gt; beta.z  2.0223329 0.05793028   1.908713  2.022335   2.135941  2.0223351</span></span>
<span><span class="co">#&gt;                 kld</span></span>
<span><span class="co">#&gt; beta.0 7.544158e-08</span></span>
<span><span class="co">#&gt; beta.z 1.786460e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for error prone variable: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.150269 0.2149914   1.729791 2.149321   2.576288 2.145365</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                mean         sd  0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.1022764 0.07118113 -0.03732593 0.1022764  0.2418787 0.1022764</span></span>
<span><span class="co">#&gt;                   kld</span></span>
<span><span class="co">#&gt; alpha.x.0 7.96191e-13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.1129806 0.02322388 0.07438284 0.1105872</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9678893 0.34211877 0.46076471 0.9136922</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2543322 0.02807902 0.20387108 0.2526852</span></span>
<span><span class="co">#&gt; Precision for id                0.4130112 0.17715507 0.16577929 0.3805028</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest  0.1654199 0.1058483</span></span>
<span><span class="co">#&gt; Precision for x classical model  1.7895525 0.8142525</span></span>
<span><span class="co">#&gt; Precision for x imp model        0.3142922 0.2492065</span></span>
<span><span class="co">#&gt; Precision for id                 0.8493061 0.3222538</span></span>
<span></span>
<span><span class="va">reff.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"coefficient_name"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.0"</span>,  <span class="fl">1</span>, </span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reff.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="interaction-effect-with-error-variable">Interaction effect with error variable<a class="anchor" aria-label="anchor" href="#interaction-effect-with-error-variable"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left">categorical variable <span class="math inline">\(s\)</span>, interaction effect <span class="math inline">\(x:s\)</span>
</td>
</tr></tbody>
</table>
<p>Interaction effects between the error prone variable and an (assumed)
error-free variable can also be used. The syntax is as normal, an
interaction effect between variables <code>x</code> and <code>s</code>
would be specified in the formula for the model of interest as
<code>x:s</code>.</p>
<div class="section level3">
<h3 id="generating-the-data-3">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-3"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x.s</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.x.s</span><span class="op">*</span><span class="va">x_obs</span><span class="op">*</span><span class="va">s</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interact_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span>, s <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-2">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-2"></a>
</h3>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interact_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">:</span><span class="va">s</span>,</span>
<span>                             formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                             family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">interact_data</span>,</span>
<span>                             error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                             prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                             prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>                             initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.imp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x:s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant    0.5quant 0.975quant        mode</span></span>
<span><span class="co">#&gt; beta.0  1.00804785 0.07956278  0.8519791  1.00805092  1.1640994  1.00805105</span></span>
<span><span class="co">#&gt; beta.s -0.08595952 0.13378731 -0.3483742 -0.08595466  0.1764274 -0.08595466</span></span>
<span><span class="co">#&gt;                 kld</span></span>
<span><span class="co">#&gt; beta.0 5.343117e-11</span></span>
<span><span class="co">#&gt; beta.s 1.295384e-11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for error prone variable: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.sx 2.055653 0.06322476   1.931226 2.055638   2.180165 2.055577</span></span>
<span><span class="co">#&gt; beta.x  1.709912 0.04042570   1.630311 1.709917   1.789482 1.709940</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                 mean         sd  0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.03481149 0.06848929 -0.09951695 0.03481149  0.1691399 0.03481149</span></span>
<span><span class="co">#&gt;                    kld</span></span>
<span><span class="co">#&gt; alpha.x.0 9.385942e-12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.sx, beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.4107964 0.03327336  0.3488971 0.4095579</span></span>
<span><span class="co">#&gt; Precision for x classical model 4.1022705 0.44157365  3.3025722 4.0784561</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2252668 0.01058525  0.2049514 0.2250854</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest  0.4798131 0.4073059</span></span>
<span><span class="co">#&gt; Precision for x classical model  5.0391146 4.0307953</span></span>
<span><span class="co">#&gt; Precision for x imp model        0.2466182 0.2248676</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="air-pollution-example">Air pollution example<a class="anchor" aria-label="anchor" href="#air-pollution-example"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Berkson, classical</td>
<td align="left">Binomial</td>
<td align="left">asthma</td>
<td align="left">airpollution</td>
<td align="left">gender, age, district</td>
</tr></tbody>
</table>
<p>In this example, we simulate data from a fictitious, but realistic
scenario where we want examine if people in areas with high air
pollution seem to have asthma more than in areas with lower air
pollution. But the air pollution value for the people in the study canot
be observed directly, instead sensors have been placed at certain
locations, and the value for a person is set to be the value gathered at
the closest sensor. This leads to a Berkson error. In addition to that,
we believe that there is some noise in the measurements due to
imprecision in the sensor. This corresponds to a classical measurement
error.</p>
<p>TODO: random intercept model for district instead of treating it as
continuous variable.</p>
<div class="section level3">
<h3 id="generating-the-data-4">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-4"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2034</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n</span>, shape <span class="op">=</span> <span class="fl">10</span>, scale <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">district</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, <span class="va">n</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">3</span>; <span class="va">alpha.district</span> <span class="op">&lt;-</span> <span class="fl">0.05</span></span>
<span><span class="va">pollution_b</span> <span class="op">&lt;-</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.district</span><span class="op">*</span><span class="va">district</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="co"># Berkson error</span></span>
<span><span class="va">pollution</span> <span class="op">&lt;-</span> <span class="va">pollution_b</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="co"># Classical and Berkson error (this is what is observed)</span></span>
<span><span class="va">pollution_correct</span> <span class="op">&lt;-</span> <span class="va">pollution_b</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Correct</span></span>
<span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">8</span>; <span class="va">beta.pollution</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.gender</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span>; </span>
<span><span class="va">beta.age</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>; <span class="va">beta.district</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">2</span></span>
<span></span>
<span><span class="va">asthma_predictor</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.pollution</span><span class="op">*</span><span class="va">pollution_correct</span> <span class="op">+</span> </span>
<span>  <span class="va">beta.gender</span><span class="op">*</span><span class="va">gender</span> <span class="op">+</span> <span class="va">beta.age</span><span class="op">*</span><span class="va">age</span> <span class="op">+</span> <span class="va">beta.district</span><span class="op">*</span><span class="va">district</span></span>
<span><span class="va">asthma_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">asthma_predictor</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">asthma_predictor</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">asthma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">asthma_prob</span><span class="op">)</span></span>
<span></span>
<span><span class="va">airpollution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>asthma <span class="op">=</span> <span class="va">asthma</span>, </span>
<span>                           pollution <span class="op">=</span> <span class="va">pollution</span>, </span>
<span>                           <span class="va">district</span>, </span>
<span>                           <span class="va">age</span>, </span>
<span>                           <span class="va">gender</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-3">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-3"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Scale the data</span></span>
<span><span class="va">airpollution_scaled</span> <span class="op">&lt;-</span> <span class="va">airpollution</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pollution</span>, <span class="va">age</span><span class="op">)</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">.</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">airpollution_moi</span> <span class="op">&lt;-</span> <span class="va">asthma</span> <span class="op">~</span> <span class="va">pollution</span> <span class="op">+</span> <span class="va">district</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gender</span></span>
<span><span class="va">airpollution_imp</span> <span class="op">&lt;-</span> <span class="va">pollution</span> <span class="op">~</span> <span class="va">district</span></span>
<span></span>
<span><span class="va">airpollution_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airpollution_scaled</span>, </span>
<span>                         formula_moi <span class="op">=</span> <span class="va">airpollution_moi</span>, </span>
<span>                         formula_imp <span class="op">=</span> <span class="va">airpollution_imp</span>, </span>
<span>                         family_moi <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                         error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"berkson"</span>, <span class="st">"classical"</span><span class="op">)</span>,</span>
<span>                         prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">999</span><span class="op">)</span>, </span>
<span>                         prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">999</span><span class="op">)</span>,</span>
<span>                         prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>                         prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                         initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">16</span><span class="op">)</span></span>
<span></span>
<span><span class="va">airpollution_summary</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">airpollution_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">airpollution.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"coefficient_name"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.pollution"</span>, <span class="va">beta.pollution</span>, </span>
<span>  <span class="st">"beta.gender"</span>,    <span class="va">beta.gender</span>, </span>
<span>  <span class="st">"beta.district"</span>,  <span class="va">beta.district</span>, </span>
<span>  <span class="st">"beta.age"</span>,       <span class="va">beta.age</span>, </span>
<span><span class="co">#  "beta.0",         beta.0, </span></span>
<span>  <span class="st">"alpha.pollution.district"</span>, <span class="va">alpha.district</span>, </span>
<span><span class="co">#  "alpha.0",        alpha.0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">airpollution_model</span>, plot_intercepts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">airpollution.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-16-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="birthweight-example-inactive">Birthweight example (inactive)<a class="anchor" aria-label="anchor" href="#birthweight-example-inactive"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing values</td>
<td align="left">Gaussian</td>
<td align="left">birthweight</td>
<td align="left">motherâ€™s weight</td>
<td align="left">age, gestation time</td>
</tr></tbody>
</table>
<p>In this example, we construct fictitious data mimicking a scenario
where we are interested in studying the birth weight of newborn babies,
and how slightly misreported weights of the mother influence the babyâ€™s
weight. In this example we therefore have the motherâ€™s weight as a
covariate with classical error, and in addition a few of the weight
measurements for the mothers are missing.</p>
<p>Status: Occasionally get crash message, this seems to be when the
response is a very different scale from the covariates. When I donâ€™t get
the crash message, I still get the wrong estimate for everything except
beta.gestationtime.</p>
<div class="section level3">
<h3 id="generating-the-data-5">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-5"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error, correlated with error-variable:</span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="va">n</span>, shape <span class="op">=</span> <span class="fl">60</span>, scale <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate without error, uncorrelated with other covariates:</span></span>
<span><span class="va">gestation_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">40</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate with classical error:</span></span>
<span><span class="va">alpha.age</span> <span class="op">&lt;-</span> <span class="fl">0.4</span>; <span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">mom_weight_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.age</span><span class="op">*</span><span class="va">age</span>, sd <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">mom_weight</span> <span class="op">&lt;-</span> <span class="va">mom_weight_correct</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="co"># Classical error</span></span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.35</span> <span class="op">-</span> <span class="fl">0.001</span><span class="op">*</span><span class="va">age</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">mom_weight</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">0</span>; <span class="va">beta.mom_weight</span> <span class="op">&lt;-</span> <span class="fl">5</span>; <span class="va">beta.age</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">5</span>; <span class="va">beta.gestation_time</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">birthweight</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.mom_weight</span><span class="op">*</span><span class="va">mom_weight_correct</span> <span class="op">+</span> </span>
<span>  <span class="va">beta.age</span><span class="op">*</span><span class="va">age</span> <span class="op">+</span> <span class="va">beta.gestation_time</span><span class="op">*</span><span class="va">gestation_time</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">birthweight</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-17-1.png" width="480" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">birthweight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">birthweight</span>, <span class="va">mom_weight</span>, <span class="va">age</span>, <span class="va">gestation_time</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-4">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-4"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Priors for y, measurement error and true x-value precision</span></span>
<span><span class="va">prior.prec.y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5)</span></span>
<span><span class="va">prior.prec.u_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5)</span></span>
<span><span class="va">prior.prec.u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5)</span></span>
<span><span class="va">prior.prec.r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="co"># Gamma(0.5, 0.5)</span></span>
<span></span>
<span><span class="co"># Initial values</span></span>
<span><span class="va">initial.prec.y</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">initial.prec.u_b</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">initial.prec.u_c</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">/</span><span class="fl">9</span></span>
<span><span class="va">initial.prec.r</span> <span class="op">&lt;-</span> <span class="fl">1</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">birthweight_scaled</span> <span class="op">&lt;-</span> <span class="va">birthweight</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">mom_weight</span>, <span class="va">age</span>, <span class="va">gestation_time</span><span class="op">)</span>, </span>
<span>                <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">.</span>, scale <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthweight_moi</span> <span class="op">&lt;-</span> <span class="va">birthweight</span> <span class="op">~</span> <span class="va">mom_weight</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gestation_time</span></span>
<span><span class="va">birthweight_imp</span> <span class="op">&lt;-</span> <span class="va">mom_weight</span> <span class="op">~</span> <span class="va">age</span> </span>
<span></span>
<span><span class="va">birthweight_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">birthweight_scaled</span>, </span>
<span>                         formula_moi <span class="op">=</span> <span class="va">birthweight_moi</span>, </span>
<span>                         formula_imp <span class="op">=</span> <span class="va">birthweight_imp</span>, </span>
<span>                         family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                         error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span><span class="op">)</span>,</span>
<span>                         prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                         prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>, </span>
<span>                         prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                         prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                         prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                         initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.classical <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">9</span>,</span>
<span>                         initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">birthweight_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">birthweight.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"coefficient_name"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.mom_weight"</span>,      <span class="va">beta.mom_weight</span>, </span>
<span>  <span class="st">"beta.gestation_time"</span>,  <span class="va">beta.gestation_time</span>, </span>
<span>  <span class="st">"beta.age"</span>,             <span class="va">beta.age</span>, </span>
<span>  <span class="co">#"beta.0",               beta.0, </span></span>
<span>  <span class="co">#"alpha.age",            alpha.age, </span></span>
<span>  <span class="co">#"alpha.0",              alpha.0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">birthweight_model</span>, plot_intercept <span class="op">=</span> <span class="cn">FALSE</span>, plot_imp <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">birthweight.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="pumpkin-weights-inactive">Pumpkin weights (inactive)<a class="anchor" aria-label="anchor" href="#pumpkin-weights-inactive"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">pumpkins_original</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu">read_csv</span><span class="op">(</span><span class="st">'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-10-19/pumpkins.csv'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">visdat</span><span class="fu">::</span><span class="fu">vis_miss</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pumpkins_original</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight_lbs"</span>, <span class="st">"ott"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pumpkins</span> <span class="op">&lt;-</span> <span class="va">pumpkins_original</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">id</span>, sep <span class="op">=</span> <span class="st">"-"</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"type"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight_lbs"</span>, <span class="st">"ott"</span>, <span class="st">"year"</span>, <span class="st">"type"</span>, <span class="st">"grower_name"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="st">"weight_lbs"</span>, <span class="st">"ott"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"type"</span><span class="op">)</span>, <span class="va">as.factor</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">drop_na</span><span class="op">(</span><span class="st">"weight_lbs"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ott</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">&amp;</span> <span class="va">ott</span> <span class="op">&lt;</span> <span class="fl">600</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># Many ott values are zero, why?</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">type</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"L"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Scale weight and ott</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight_lbs"</span>, <span class="st">"ott"</span><span class="op">)</span>, <span class="op">~</span> <span class="op">(</span><span class="va">.</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ott2 <span class="op">=</span> <span class="va">ott</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_match.html" class="external-link">case_match</a></span><span class="op">(</span><span class="va">type</span>, </span>
<span>                           <span class="st">"F"</span> <span class="op">~</span> <span class="st">"Field_Pumpkin"</span>,</span>
<span>                           <span class="st">"P"</span> <span class="op">~</span> <span class="st">"Giant_Pumpkin"</span>,</span>
<span>                           <span class="st">"S"</span> <span class="op">~</span> <span class="st">"Giant_Squash"</span>,</span>
<span>                           <span class="st">"W"</span> <span class="op">~</span> <span class="st">"Giant_Watermelon"</span>,</span>
<span>                           <span class="st">"L"</span> <span class="op">~</span> <span class="st">"Long_Gourd"</span>,</span>
<span>                           <span class="st">"T"</span> <span class="op">~</span> <span class="st">"Tomato"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="co"># Dummy code the type:</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>dum <span class="op">=</span> <span class="fl">1</span>, type_copy <span class="op">=</span> <span class="va">type</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type_copy</span>,</span>
<span>              values_from <span class="op">=</span> <span class="va">dum</span>,</span>
<span>              values_fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Types: F = "Field Pumpkin", P = "Giant Pumpkin", S = "Giant Squash", W = "Giant Watermelon", L = "Long Gourd" (length in inches, not weight in pounds), T = Tomato</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pumpkins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ott</span>, y <span class="op">=</span> <span class="va">weight_lbs</span>, color <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pumpkins</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pumpkin_model_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">weight_lbs</span> <span class="op">~</span> <span class="va">ott</span><span class="op">*</span><span class="va">type</span>, data <span class="op">=</span> <span class="va">pumpkins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pumpkin_model_lm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ott_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">ott</span> <span class="op">~</span> <span class="va">type</span>, data <span class="op">=</span> <span class="va">pumpkins</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ott_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#library(lme4)</span></span>
<span><span class="co">#pumpkin_lmer &lt;- lmer(weight_lbs ~ ott + (ott | type), data = pumpkins)</span></span>
<span><span class="co">#coef(pumpkin_model)$type</span></span>
<span><span class="co">#plot(pumpkin_model)</span></span>
<span></span>
<span><span class="co"># Artificially remove some of the ott measurements</span></span>
<span><span class="va">missing_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="cn">NA</span><span class="op">)</span>, size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">pumpkins</span><span class="op">)</span>, </span>
<span>                     prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.3</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">pumpkins</span><span class="op">$</span><span class="va">ott_truth</span> <span class="op">&lt;-</span> <span class="va">pumpkins</span><span class="op">$</span><span class="va">ott</span></span>
<span><span class="va">pumpkins</span><span class="op">$</span><span class="va">ott</span> <span class="op">&lt;-</span> <span class="va">pumpkins</span><span class="op">$</span><span class="va">ott_truth</span><span class="op">*</span><span class="va">missing_id</span></span>
<span></span>
<span><span class="fu">visdat</span><span class="fu">::</span><span class="fu">vis_miss</span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pumpkins</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"weight_lbs"</span>, <span class="st">"ott"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlamemi/">inlamemi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inla_pumpkin_naive</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight_lbs</span> <span class="op">~</span> <span class="va">ott</span> <span class="op">+</span> <span class="va">Giant_Pumpkin</span> <span class="op">+</span> <span class="va">Giant_Squash</span> <span class="op">+</span> <span class="va">Giant_Watermelon</span>, </span>
<span>  data <span class="op">=</span> <span class="va">pumpkins</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inla_pumpkin_correct</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">weight_lbs</span> <span class="op">~</span> <span class="va">ott_truth</span> <span class="op">+</span> <span class="va">Giant_Pumpkin</span> <span class="op">+</span> <span class="va">Giant_Squash</span> <span class="op">+</span> <span class="va">Giant_Watermelon</span>, </span>
<span>  data <span class="op">=</span> <span class="va">pumpkins</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">inla_pumpkin_naive</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span><span class="va">inla_pumpkin_correct</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span></span>
<span><span class="va">pumpkin_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span></span>
<span>  formula_moi <span class="op">=</span> <span class="va">weight_lbs</span> <span class="op">~</span> <span class="va">ott</span> <span class="op">+</span> <span class="va">Giant_Pumpkin</span> <span class="op">+</span> <span class="va">Giant_Squash</span> <span class="op">+</span> <span class="va">Giant_Watermelon</span>,</span>
<span>  formula_imp <span class="op">=</span> <span class="va">ott</span> <span class="op">~</span> <span class="va">weight_lbs</span> <span class="op">+</span> <span class="va">Giant_Pumpkin</span> <span class="op">+</span> <span class="va">Giant_Squash</span> <span class="op">+</span> <span class="va">Giant_Watermelon</span>,</span>
<span>  family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">pumpkins</span>,</span>
<span>  error_type <span class="op">=</span> <span class="st">"missing"</span>,</span>
<span>  prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>  initial.prec.moi <span class="op">=</span> <span class="fl">0.28</span>,</span>
<span>  initial.prec.imp <span class="op">=</span> <span class="fl">0.76</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pumpkin_model</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pumpkin_model</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pumpkin_model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span></span>
<span><span class="fu">summary.inla</span><span class="op">(</span><span class="va">pumpkin_model</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Emma Skarstein, Stefanie Muff.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
