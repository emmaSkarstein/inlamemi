<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="inlamemi">
<title>Simulated examples â€¢ inlamemi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulated examples">
<meta property="og:description" content="inlamemi">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">inlamemi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a>
    <a class="dropdown-item" href="../articles/how_to_not_use_inlamemi.html">How to not use inlamemi</a>
    <a class="dropdown-item" href="../articles/modifying_default_plot.html">Modifying the default plot</a>
    <a class="dropdown-item" href="../articles/multiple_error_variables.html">Multiple variables with measurement error and missingness</a>
    <a class="dropdown-item" href="../articles/nhanes_survival.html">Survival data with repeated systolic blood pressure measurements</a>
    <a class="dropdown-item" href="../articles/simulated_examples.html">Simulated examples</a>
    <a class="dropdown-item" href="../articles/Visualize_model_structure.html">How are the models structured?</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/emmaSkarstein/inlamemi/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Simulated examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emmaSkarstein/inlamemi/blob/HEAD/vignettes/simulated_examples.Rmd" class="external-link"><code>vignettes/simulated_examples.Rmd</code></a></small>
      <div class="d-none name"><code>simulated_examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlamemi/">inlamemi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette shows how to fit measurement error and imputation
models using the <code>inlamemi</code> package for a few different
simple simulated data sets. Note that although the data sets describe
realistic situations, they are all completely fictitious, and created
purely to illustrate how to fit models in different situations.</p>
<div class="section level2">
<h2 id="simple-example-with-missingness-and-two-types-of-measurement-error">Simple example with missingness and two types of measurement
error<a class="anchor" aria-label="anchor" href="#simple-example-with-missingness-and-two-types-of-measurement-error"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Berkson, classical, missing values</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>This is a simple simulation with Berkson and classical error as well
as missing data, to check that the package works as expected in that
scenario.</p>
<div class="section level3">
<h3 id="generating-the-data">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Berkson error:</span></span>
<span><span class="va">u_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_b</span> <span class="co"># Turn off Berkson by commenting out "+ u_b"</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">simple_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple_data</span>, </span>
<span>                         formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, </span>
<span>                         formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>, </span>
<span>                         family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                         error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"berkson"</span>, <span class="st">"classical"</span><span class="op">)</span>,</span>
<span>                         prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,   <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>, <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, <span class="co"># N(0, 10^3)</span></span>
<span>                         initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "berkson"   "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.0 1.038635 0.2175137   0.615608 1.041372   1.438867 1.033996</span></span>
<span><span class="co">#&gt; beta.z 1.929028 0.3863951   1.221052 1.923004   2.568637 1.923410</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;           mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 1.97454 0.2018476   1.575241 1.975201   2.369987 1.977948</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.033089 0.05059578   0.933832 1.033096   1.132305 1.033096</span></span>
<span><span class="co">#&gt; alpha.x.z 2.024688 0.05225743   1.922237 2.024672   2.127228 2.024672</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean        sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.1339672 0.3683325  0.5627567 1.0833119</span></span>
<span><span class="co">#&gt; Precision for x berkson model   1.1252922 0.3414295  0.5999704 1.0769434</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9248930 0.1091668  0.7293616 0.9182738</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.9780651 0.1257760  0.7530930 0.9703498</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest   1.996273 0.9902936</span></span>
<span><span class="co">#&gt; Precision for x berkson model     1.930994 0.9864926</span></span>
<span><span class="co">#&gt; Precision for x classical model   1.158576 0.9047101</span></span>
<span><span class="co">#&gt; Precision for x imp model         1.247448 0.9555969</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>, </span>
<span><span class="co">#  "beta.0",  beta.0, </span></span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span>, </span>
<span> <span class="co"># "alpha.0", alpha.0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simple_model</span>, plot_intercepts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="missing-data-only">Missing data only<a class="anchor" aria-label="anchor" href="#missing-data-only"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Missing values</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>In this example, we have missingness in one covariate, but no other
measurement error, so this shows how to do simple imputation of a
missing covariate in R-INLA.</p>
<div class="section level3">
<h3 id="generating-the-data-1">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-1"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without missingness:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate that will have missingness:</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">missing_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-without-imputation">Model without imputation<a class="anchor" aria-label="anchor" href="#model-without-imputation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, data <span class="op">=</span> <span class="va">missing_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span><span class="co">#&gt;                 mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; (Intercept) 2.059952 0.07313492  1.9165113 2.059952   2.203392 2.059952</span></span>
<span><span class="co">#&gt; x           1.060038 0.04847764  0.9649586 1.060038   1.155118 1.060038</span></span>
<span><span class="co">#&gt; z           4.242952 0.09766027  4.0514099 4.242952   4.434494 4.242952</span></span>
<span><span class="co">#&gt;                      kld</span></span>
<span><span class="co">#&gt; (Intercept) 1.017087e-11</span></span>
<span><span class="co">#&gt; x           1.020428e-11</span></span>
<span><span class="co">#&gt; z           1.015061e-11</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.hyperpar</span></span>
<span><span class="co">#&gt;                                              mean         sd 0.025quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.3082829 0.01379352  0.2818484</span></span>
<span><span class="co">#&gt;                                         0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.308078  0.3359021 0.3076677</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-with-imputation">Model with imputation<a class="anchor" aria-label="anchor" href="#model-with-imputation"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>,</span>
<span>                            formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                            family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">missing_data</span>, </span>
<span>                            error_type <span class="op">=</span> <span class="st">"missing"</span>, </span>
<span>                            prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                            initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "missing"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant 0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; beta.0 0.9744652 0.04863765  0.8798999 0.974522   1.068909 0.9745817</span></span>
<span><span class="co">#&gt; beta.z 1.9451450 0.07657972  1.7986450 1.945431   2.091358 1.9455514</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;            mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.024501 0.03435841   1.956795 2.024524   2.092077 2.024617</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.031102 0.03139427  0.9695376 1.031099   1.092686 1.031099</span></span>
<span><span class="co">#&gt; alpha.x.z 1.983401 0.03209626  1.9204483 1.983402   2.046350 1.983402</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                     mean         sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.055423 0.05222517  0.9546903 1.054696</span></span>
<span><span class="co">#&gt; Precision for x classical model 1.145520 0.39694852  0.5887609 1.073555</span></span>
<span><span class="co">#&gt; Precision for x imp model       1.065801 0.04989532  0.9717332 1.064368</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest   1.160249 1.0544813</span></span>
<span><span class="co">#&gt; Precision for x classical model   2.128387 0.9376045</span></span>
<span><span class="co">#&gt; Precision for x imp model         1.168149 1.0609349</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.0"</span>, <span class="va">beta.0</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>,</span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="va">alpha.0</span>,</span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">missing_truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-8-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="random-effect-in-the-main-model">Random effect in the main model<a class="anchor" aria-label="anchor" href="#random-effect-in-the-main-model"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left">
<span class="math inline">\(z\)</span>, random effect
<span class="math inline">\(w\)</span>
</td>
</tr></tbody>
</table>
<p>In this example, we simulate data that is grouped in such a way that
it should be modelled with a random effect in the model of interest.</p>
<div class="section level3">
<h3 id="generating-the-data-2">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-2"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># number of groups</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of observations per group</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">*</span><span class="va">n</span> <span class="co"># total number of observations</span></span>
<span></span>
<span><span class="va">sd_y</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># sd for the noise</span></span>
<span><span class="va">sd_w</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for random effect</span></span>
<span><span class="va">sd_x</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for covariate without error</span></span>
<span><span class="va">sd_u</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># sd for measurement error</span></span>
<span></span>
<span><span class="co"># Covariate without error</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate with error</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_x</span><span class="op">)</span> <span class="co"># Independent of z, but can change that here</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random effect</span></span>
<span><span class="va">w_per_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">0</span>, <span class="va">sd_w</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">w_per_group</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-1">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-1"></a>
</h3>
<p>Firstly, if we ignored the measurement error, we might fit a model
like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">naive_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time used:</span></span>
<span><span class="co">#&gt;     Pre = 0.225, Running = 0.201, Post = 0.0175, Total = 0.444 </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">#&gt; (Intercept) -0.316 0.560     -1.429   -0.316      0.796 -0.316   0</span></span>
<span><span class="co">#&gt; x            1.682 0.051      1.582    1.682      1.782  1.682   0</span></span>
<span><span class="co">#&gt; z            2.022 0.058      1.908    2.022      2.136  2.022   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;   Name     Model</span></span>
<span><span class="co">#&gt;     id IID model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters:</span></span>
<span><span class="co">#&gt;                                          mean    sd 0.025quant 0.5quant</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.077 0.003      0.070    0.077</span></span>
<span><span class="co">#&gt; Precision for id                        0.401 0.184      0.145    0.367</span></span>
<span><span class="co">#&gt;                                         0.975quant  mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations      0.084 0.077</span></span>
<span><span class="co">#&gt; Precision for id                             0.852 0.305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal log-Likelihood:  -2756.06 </span></span>
<span><span class="co">#&gt;  is computed </span></span>
<span><span class="co">#&gt; Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">#&gt; (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># curve(dgamma(x, shape = 1.5, rate = 2), to = 2)</span></span>
<span></span>
<span><span class="va">reff_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> </span>
<span>                         <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span>, hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="op">-</span><span class="fl">15</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                       initial.prec.moi <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, </span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z + f(id, model = "iid", hyper = list(prec = list(initial = -15, </span></span>
<span><span class="co">#&gt;     param = c(2, 2))))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;              mean         sd 0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; beta.0 -0.3662256 0.54823854  -1.456879 -0.3665273  0.7262112 -0.3664901</span></span>
<span><span class="co">#&gt; beta.z  2.0222470 0.05794345   1.908596  2.0222502  2.1358799  2.0222502</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;           mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.13938 0.2020085   1.748365 2.137126   2.543716 2.127548</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                mean         sd  0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.1022764 0.07114812 -0.03726209 0.1022764   0.241815 0.1022764</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.1113251 0.02114771 0.07611931 0.1091624</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9847970 0.33919367 0.47196005 0.9341187</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2529571 0.02680623 0.20499104 0.2513152</span></span>
<span><span class="co">#&gt; Precision for id                0.4156247 0.17755387 0.16707826 0.3832582</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest  0.1590784 0.1046600</span></span>
<span><span class="co">#&gt; Precision for x classical model  1.7902911 0.8407561</span></span>
<span><span class="co">#&gt; Precision for x imp model        0.3104215 0.2475987</span></span>
<span><span class="co">#&gt; Precision for id                 0.8522721 0.3251064</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">reff.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.0"</span>,  <span class="fl">1</span>, </span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reff.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="interaction-effect-with-error-variable">Interaction effect with error variable<a class="anchor" aria-label="anchor" href="#interaction-effect-with-error-variable"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(x\)</span></td>
<td align="left">categorical variable <span class="math inline">\(s\)</span>, interaction effect <span class="math inline">\(x:s\)</span>
</td>
</tr></tbody>
</table>
<p>Interaction effects between the error prone variable and an (assumed)
error-free variable can also be used. The syntax is as normal, an
interaction effect between variables <code>x</code> and <code>s</code>
would be specified in the formula for the model of interest as
<code>x:s</code>.</p>
<div class="section level3">
<h3 id="generating-the-data-3">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-3"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x.s</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.x.s</span><span class="op">*</span><span class="va">x_obs</span><span class="op">*</span><span class="va">s</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interact_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span>, s <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-2">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-2"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interact_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">:</span><span class="va">s</span>,</span>
<span>                             formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                             family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">interact_data</span>,</span>
<span>                             error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                             prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                             prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>                             initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.imp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x:s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;              mean         sd 0.025quant    0.5quant 0.975quant        mode</span></span>
<span><span class="co">#&gt; beta.0  1.0079912 0.07956684  0.8519145  1.00799419   1.164051  1.00799433</span></span>
<span><span class="co">#&gt; beta.s -0.0859873 0.13380727 -0.3484410 -0.08598247   0.176439 -0.08598247</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.sx 2.055563 0.06331749   1.932066 2.055169   2.181368 2.053518</span></span>
<span><span class="co">#&gt; beta.x  1.710070 0.04049114   1.630059 1.710172   1.789487 1.710596</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                 mean         sd  0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.03481149 0.06851867 -0.09957463 0.03481149  0.1691976 0.03481149</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.sx, beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.4108496 0.03341748  0.3485568 0.4096486</span></span>
<span><span class="co">#&gt; Precision for x classical model 4.1021378 0.44333493  3.3047463 4.0763564</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2253200 0.01060232  0.2051422 0.2250801</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest  0.4800372 0.4075724</span></span>
<span><span class="co">#&gt; Precision for x classical model  5.0482694 4.0212848</span></span>
<span><span class="co">#&gt; Precision for x imp model        0.2468776 0.2246212</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="simulated_examples_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="logistic-regression-with-classical-error-and-missing-data">Logistic regression with classical error and missing data<a class="anchor" aria-label="anchor" href="#logistic-regression-with-classical-error-and-missing-data"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing</td>
<td align="left">Binomial</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(w\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>Here we show how to fit a logistic regression model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">z</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Error</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generating missing data, depending on z</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">prob_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">missing_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob_missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion missing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">)</span><span class="op">/</span><span class="va">nn</span></span>
<span><span class="co">#&gt; [1] 0.393</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Replace the values in w by missing in case the index for missingness is =1:</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">==</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="va">w</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate binomial response</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> </span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, z <span class="op">=</span> <span class="va">z</span>, y <span class="op">=</span> <span class="va">y</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
<p>Modeling error and missing data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_binom</span>,</span>
<span>                       formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">w</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       formula_mis <span class="op">=</span> <span class="va">m</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span>,<span class="st">"missing"</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_binom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_binom</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="poisson-regression-with-classical-error-and-missing-data">Poisson regression with classical error and missing data<a class="anchor" aria-label="anchor" href="#poisson-regression-with-classical-error-and-missing-data"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing</td>
<td align="left">Poisson</td>
<td align="left"><span class="math inline">\(y\)</span></td>
<td align="left"><span class="math inline">\(w\)</span></td>
<td align="left"><span class="math inline">\(z\)</span></td>
</tr></tbody>
</table>
<p>Here we show how to fit a Poisson regression model, where the model
of interest has a random intercept term.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">z</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Error</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generating missing data, depending on z</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">prob_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">missing_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob_missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion missing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">)</span><span class="op">/</span><span class="va">nn</span></span>
<span><span class="co">#&gt; [1] 0.393</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Replace the values in w by missing in case the index for missingness is =1:</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">==</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="va">w</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random effect to include in the regression model:</span></span>
<span><span class="va">re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span><span class="op">/</span><span class="fl">20</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear predictor</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span>  <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="va">re</span>  </span>
<span></span>
<span><span class="co"># Generate Poisson response</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, z <span class="op">=</span> <span class="va">z</span>, y <span class="op">=</span> <span class="va">y</span>, w <span class="op">=</span> <span class="va">w</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Simple regression models with correct and error-prone variables to
check the effect:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glmer</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_pois</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glmer</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_pois</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
<p>Modeling error and missing data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_pois</span>,</span>
<span>                       formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>,model<span class="op">=</span><span class="st">"iid"</span><span class="op">)</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">w</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       formula_mis <span class="op">=</span> <span class="va">m</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span>,<span class="st">"missing"</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_pois</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_pois</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emma Skarstein, Stefanie Muff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
