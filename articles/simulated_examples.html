<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Simulated examples â€¢ inlamemi</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulated examples">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">inlamemi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/building_models_without_inlamemi.html">How to avoid using inlamemi</a></li>
    <li><a class="dropdown-item" href="../articles/Framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a></li>
    <li><a class="dropdown-item" href="../articles/modifying_default_plot.html">Modifying the default plot</a></li>
    <li><a class="dropdown-item" href="../articles/multiple_error_variables.html">Multiple variables with measurement error and missingness</a></li>
    <li><a class="dropdown-item" href="../articles/nhanes_survival_model.html">Survival model with repeated systolic blood pressure measurements</a></li>
    <li><a class="dropdown-item" href="../articles/simulated_examples.html">Simulated examples</a></li>
    <li><a class="dropdown-item" href="../articles/Visualize_model_structure.html">How are the models structured?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emmaSkarstein/inlamemi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulated examples</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/emmaSkarstein/inlamemi/blob/main/vignettes/simulated_examples.Rmd" class="external-link"><code>vignettes/simulated_examples.Rmd</code></a></small>
      <div class="d-none name"><code>simulated_examples.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">INLA</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlamemi/">inlamemi</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette shows how to fit measurement error and imputation
models using the <code>inlamemi</code> package for a few different
simple simulated data sets. Note that although the data sets describe
realistic situations, they are all completely fictitious, and created
purely to illustrate how to fit models in different situations.</p>
<div class="section level2">
<h2 id="simple-example-with-missingness-and-two-types-of-measurement-error">Simple example with missingness and two types of measurement
error<a class="anchor" aria-label="anchor" href="#simple-example-with-missingness-and-two-types-of-measurement-error"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Berkson, classical, missing values</td>
<td align="left">Gaussian</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></td>
</tr></tbody>
</table>
<p>This is a simple simulation with Berkson and classical error as well
as missing data, to check that the package works as expected in that
scenario.</p>
<div class="section level3">
<h3 id="generating-the-data">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Berkson error:</span></span>
<span><span class="va">u_b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_b</span> <span class="co"># Turn off Berkson by commenting out "+ u_b"</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">r</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">simple_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Fit the model</span></span>
<span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple_data</span>, </span>
<span>                         formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, </span>
<span>                         formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>, </span>
<span>                         family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                         error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"berkson"</span>, <span class="st">"classical"</span><span class="op">)</span>,</span>
<span>                         prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,   <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>, <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,       <span class="co"># Gamma(10, 9)</span></span>
<span>                         prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, <span class="co"># N(0, 10^3)</span></span>
<span>                         initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                         initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "berkson"   "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.0 1.027602 0.2186511  0.6083084 1.025492   1.436240 1.020619</span></span>
<span><span class="co">#&gt; beta.z 1.906201 0.3876191  1.2160591 1.893875   2.558432 1.903803</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 1.973221 0.2015696   1.570253 1.975306   2.363884 1.984143</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.033079 0.05058874  0.9338329 1.033087   1.132280 1.033087</span></span>
<span><span class="co">#&gt; alpha.x.z 2.024709 0.05225086  1.9222764 2.024692   2.127243 2.024692</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean        sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.1289547 0.3578772  0.5722733 1.0802543   1.965920 0.9906998</span></span>
<span><span class="co">#&gt; Precision for x berkson model   1.1271920 0.3433899  0.5920915 1.0807322   1.930556 0.9946972</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9260566 0.1084821  0.7324524 0.9192407   1.158996 0.9047465</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.9779655 0.1252989  0.7530223 0.9705594   1.245496 0.9569073</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>, </span>
<span><span class="co">#  "beta.0",  beta.0, </span></span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span>, </span>
<span> <span class="co"># "alpha.0", alpha.0</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simple_model</span>, plot_intercepts <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure%2Funnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4"><p class="caption">
plot of chunk unnamed-chunk-4
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="missing-data-only">Missing data only<a class="anchor" aria-label="anchor" href="#missing-data-only"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Missing values</td>
<td align="left">Gaussian</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></td>
</tr></tbody>
</table>
<p>In this example, we have missingness in one covariate, but no other
measurement error, so this shows how to do simple imputation of a
missing covariate in R-INLA.</p>
<div class="section level3">
<h3 id="generating-the-data-1">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-1"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without missingness:</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate that will have missingness:</span></span>
<span><span class="va">alpha.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">alpha.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="va">alpha.0</span> <span class="op">+</span> <span class="va">alpha.z</span><span class="op">*</span><span class="va">z</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x</span> <span class="op">&lt;-</span> <span class="fl">2</span>; <span class="va">beta.z</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.z</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Missingness:</span></span>
<span><span class="va">m_pred</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1.5</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">z</span> <span class="co"># This gives a mean probability of missing of ca 0.2.</span></span>
<span><span class="va">m_prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">m_pred</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">m_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">as.logical</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">1</span>, prob <span class="op">=</span> <span class="va">m_prob</span><span class="op">)</span><span class="op">)</span> <span class="co"># MAR</span></span>
<span><span class="co"># m_index &lt;- sample(1:n, 0.2*n, replace = FALSE) # MCAR</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span></span>
<span><span class="va">x_obs</span><span class="op">[</span><span class="va">m_index</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="va">missing_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-without-imputation">Model without imputation<a class="anchor" aria-label="anchor" href="#model-without-imputation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>, data <span class="op">=</span> <span class="va">missing_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.fixed</span></span>
<span><span class="co">#&gt;                 mean         sd 0.025quant 0.5quant 0.975quant     mode          kld</span></span>
<span><span class="co">#&gt; (Intercept) 2.059952 0.07313492  1.9165113 2.059952   2.203392 2.059952 1.012936e-11</span></span>
<span><span class="co">#&gt; x           1.060038 0.04847764  0.9649586 1.060038   1.155118 1.060038 1.018066e-11</span></span>
<span><span class="co">#&gt; z           4.242952 0.09766027  4.0514099 4.242952   4.434494 4.242952 1.033686e-11</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span><span class="op">$</span><span class="va">summary.hyperpar</span></span>
<span><span class="co">#&gt;                                              mean         sd 0.025quant 0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.3082829 0.01379352  0.2818484 0.308078  0.3359021 0.3076677</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-with-imputation">Model with imputation<a class="anchor" aria-label="anchor" href="#model-with-imputation"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>,</span>
<span>                            formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                            family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">missing_data</span>, </span>
<span>                            error_type <span class="op">=</span> <span class="st">"missing"</span>, </span>
<span>                            prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>                            prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                            initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                            initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "missing"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; beta.0 0.9735076 0.04830102  0.8800577 0.9733148   1.067603 0.9731718</span></span>
<span><span class="co">#&gt; beta.z 1.9432463 0.07576310  1.7996969 1.9421270   2.088043 1.9412456</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;            mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.024994 0.03435627   1.956587 2.025256   2.091859 2.026359</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.031090 0.03135672  0.9695993 1.031087   1.092600 1.031087</span></span>
<span><span class="co">#&gt; alpha.x.z 1.983403 0.03205811  1.9205258 1.983404   2.046277 1.983404</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                     mean         sd 0.025quant 0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.056684 0.05223063  0.9570575 1.055579   1.162652 1.0537658</span></span>
<span><span class="co">#&gt; Precision for x classical model 1.143309 0.34507593  0.6479685 1.084275   1.989363 0.9643537</span></span>
<span><span class="co">#&gt; Precision for x imp model       1.065744 0.04963685  0.9696392 1.065177   1.165013 1.0653465</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">missing_truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.0"</span>, <span class="va">beta.0</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="va">beta.x</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="va">beta.z</span>,</span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="va">alpha.0</span>,</span>
<span>  <span class="st">"alpha.x.z"</span>, <span class="va">alpha.z</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">missing_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">missing_truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure%2Funnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8"><p class="caption">
plot of chunk unnamed-chunk-8
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="random-effect-in-the-main-model">Random effect in the main model<a class="anchor" aria-label="anchor" href="#random-effect-in-the-main-model"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></td>
<td align="left">
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>,
random effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
</td>
</tr></tbody>
</table>
<p>In this example, we simulate data that is grouped in such a way that
it should be modelled with a random effect in the model of interest.</p>
<div class="section level3">
<h3 id="generating-the-data-2">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-2"></a>
</h3>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="co"># number of groups</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="co"># number of observations per group</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="va">m</span><span class="op">*</span><span class="va">n</span> <span class="co"># total number of observations</span></span>
<span></span>
<span><span class="va">sd_y</span> <span class="op">&lt;-</span> <span class="fl">3</span> <span class="co"># sd for the noise</span></span>
<span><span class="va">sd_w</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for random effect</span></span>
<span><span class="va">sd_x</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="co"># sd for covariate without error</span></span>
<span><span class="va">sd_u</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="co"># sd for measurement error</span></span>
<span></span>
<span><span class="co"># Covariate without error</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Covariate with error</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_x</span><span class="op">)</span> <span class="co"># Independent of z, but can change that here</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_u</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random effect</span></span>
<span><span class="va">w_per_group</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">m</span>, <span class="fl">0</span>, <span class="va">sd_w</span><span class="op">)</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">w_per_group</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Response</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="fl">2</span><span class="op">*</span><span class="va">z</span> <span class="op">+</span> <span class="va">w</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="va">sd_y</span><span class="op">)</span></span>
<span></span>
<span><span class="va">reff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">m</span>, each <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-1">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-1"></a>
</h3>
<p>Firstly, if we ignored the measurement error, we might fit a model
like this:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">naive_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/inla.html" class="external-link">inla</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                    family <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">naive_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Time used:</span></span>
<span><span class="co">#&gt;     Pre = 1.63, Running = 0.679, Post = 0.0465, Total = 2.36 </span></span>
<span><span class="co">#&gt; Fixed effects:</span></span>
<span><span class="co">#&gt;               mean    sd 0.025quant 0.5quant 0.975quant   mode kld</span></span>
<span><span class="co">#&gt; (Intercept) -0.316 0.560     -1.429   -0.316      0.796 -0.316   0</span></span>
<span><span class="co">#&gt; x            1.682 0.051      1.582    1.682      1.782  1.682   0</span></span>
<span><span class="co">#&gt; z            2.022 0.058      1.908    2.022      2.136  2.022   0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Random effects:</span></span>
<span><span class="co">#&gt;   Name     Model</span></span>
<span><span class="co">#&gt;     id IID model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters:</span></span>
<span><span class="co">#&gt;                                          mean    sd 0.025quant 0.5quant 0.975quant  mode</span></span>
<span><span class="co">#&gt; Precision for the Gaussian observations 0.077 0.003      0.070    0.077      0.084 0.077</span></span>
<span><span class="co">#&gt; Precision for id                        0.401 0.184      0.145    0.367      0.852 0.305</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Marginal log-Likelihood:  -2756.06 </span></span>
<span><span class="co">#&gt;  is computed </span></span>
<span><span class="co">#&gt; Posterior summaries for the linear predictor and the fitted values are computed</span></span>
<span><span class="co">#&gt; (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># curve(dgamma(x, shape = 1.5, rate = 2), to = 2)</span></span>
<span></span>
<span><span class="va">reff_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> </span>
<span>                         <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>, model <span class="op">=</span> <span class="st">"iid"</span>, hyper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>prec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="op">-</span><span class="fl">15</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                       data <span class="op">=</span> <span class="va">reff_data</span>,</span>
<span>                       initial.prec.moi <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, </span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>,</span>
<span>                       prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">10</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z + f(id, model = "iid", hyper = list(prec = list(initial = -15, </span></span>
<span><span class="co">#&gt;     param = c(2, 2))))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;              mean         sd 0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; beta.0 -0.3659492 0.54014774  -1.440257 -0.3661872  0.7098422 -0.3661385</span></span>
<span><span class="co">#&gt; beta.z  2.0223038 0.05791576   1.908708  2.0223069  2.1358823  2.0223069</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 2.136576 0.1978989    1.75516 2.133829   2.534286 2.122058</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                mean        sd  0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.1022764 0.0711425 -0.03725084 0.1022764  0.2418037 0.1022764</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.1111287 0.02063900 0.07677898 0.1090154  0.1577547 0.1045383</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9863541 0.33507883 0.47537156 0.9376203  1.7781313 0.8478562</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2526082 0.02629019 0.20565550 0.2509687  0.3090606 0.2471533</span></span>
<span><span class="co">#&gt; Precision for id                0.4122585 0.16678697 0.16510576 0.3857361  0.8099128 0.3358915</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">reff.truth</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="st">"variable"</span>, <span class="op">~</span><span class="st">"value"</span>,</span>
<span>  <span class="st">"beta.x"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.z"</span>,  <span class="fl">2</span>, </span>
<span>  <span class="st">"beta.0"</span>,  <span class="fl">1</span>, </span>
<span>  <span class="st">"alpha.x.0"</span>, <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">reff_model</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">reff.truth</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure%2Funnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11"><p class="caption">
plot of chunk unnamed-chunk-11
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="interaction-effect-with-error-variable">Interaction effect with error variable<a class="anchor" aria-label="anchor" href="#interaction-effect-with-error-variable"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical</td>
<td align="left">Gaussian</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math></td>
<td align="left">categorical variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>s</mi><annotation encoding="application/x-tex">s</annotation></semantics></math>,
interaction effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>:</mo><mi>s</mi></mrow><annotation encoding="application/x-tex">x:s</annotation></semantics></math>
</td>
</tr></tbody>
</table>
<p>Interaction effects between the error prone variable and an (assumed)
error-free variable can also be used. The syntax is as normal, an
interaction effect between variables <code>x</code> and <code>s</code>
would be specified in the formula for the model of interest as
<code>x:s</code>.</p>
<div class="section level3">
<h3 id="generating-the-data-3">Generating the data<a class="anchor" aria-label="anchor" href="#generating-the-data-3"></a>
</h3>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2024</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co"># Covariate without error:</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classical error:</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">u_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x_obs</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">u_c</span> </span>
<span></span>
<span><span class="co"># Response:</span></span>
<span><span class="va">beta.0</span> <span class="op">&lt;-</span> <span class="fl">1</span>; <span class="va">beta.x.s</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">beta.0</span> <span class="op">+</span> <span class="va">beta.x</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">beta.x.s</span><span class="op">*</span><span class="va">x_obs</span><span class="op">*</span><span class="va">s</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span></span>
<span><span class="va">interact_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">y</span>, x <span class="op">=</span> <span class="va">x_obs</span>, z <span class="op">=</span> <span class="va">z</span>, s <span class="op">=</span> <span class="va">s</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitting-the-model-2">Fitting the model<a class="anchor" aria-label="anchor" href="#fitting-the-model-2"></a>
</h3>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">interact_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">:</span><span class="va">s</span>,</span>
<span>                             formula_imp <span class="op">=</span> <span class="va">x</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                             family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">interact_data</span>,</span>
<span>                             error_type <span class="op">=</span> <span class="st">"classical"</span>,</span>
<span>                             prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>                             prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                             prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">8</span><span class="op">)</span>,</span>
<span>                             initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                             initial.prec.imp <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x:s</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "classical"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant    0.5quant 0.975quant        mode</span></span>
<span><span class="co">#&gt; beta.0  1.00806625 0.07957354  0.8519766  1.00806929  1.1641390  1.00806941</span></span>
<span><span class="co">#&gt; beta.s -0.08599411 0.13378176 -0.3483978 -0.08598926  0.1763819 -0.08598926</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;             mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.sx 2.055651 0.06317748   1.931571 2.055549   2.180323 2.055127</span></span>
<span><span class="co">#&gt; beta.x  1.709734 0.04039037   1.630268 1.709716   1.789299 1.709645</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;                 mean         sd  0.025quant   0.5quant 0.975quant       mode</span></span>
<span><span class="co">#&gt; alpha.x.0 0.03481148 0.06849579 -0.09952965 0.03481148  0.1691526 0.03481148</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.sx, beta.x): </span></span>
<span><span class="co">#&gt;                                      mean         sd 0.025quant  0.5quant 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest 0.4107183 0.03317928  0.3491489 0.4094301  0.4796973 0.4069626</span></span>
<span><span class="co">#&gt; Precision for x classical model 4.1014561 0.43981351  3.3020907 4.0787164  5.0316880 4.0349042</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.2252702 0.01058364  0.2050005 0.2250743  0.2466613 0.2247959</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">interact_model</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure%2Funnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14"><p class="caption">
plot of chunk unnamed-chunk-14
</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="logistic-regression-with-classical-error-and-missing-data">Logistic regression with classical error and missing data<a class="anchor" aria-label="anchor" href="#logistic-regression-with-classical-error-and-missing-data"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing</td>
<td align="left">Binomial</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></td>
</tr></tbody>
</table>
<p>Here we show how to fit a logistic regression model.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">z</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Error</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generating missing data, depending on z</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">prob_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">missing_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob_missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion missing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">)</span><span class="op">/</span><span class="va">nn</span></span>
<span><span class="co">#&gt; [1] 0.393</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Replace the values in w by missing in case the index for missingness is =1:</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">==</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="va">w</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate binomial response</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> </span>
<span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, z <span class="op">=</span> <span class="va">z</span>, y <span class="op">=</span> <span class="va">y</span>, w <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span></code></pre></div>
<p>Modeling error and missing data:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_binom</span>,</span>
<span>                       formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">w</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       formula_mis <span class="op">=</span> <span class="va">m</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span>,<span class="st">"missing"</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_binom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_binom</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="poisson-regression-with-classical-error-and-missing-data">Poisson regression with classical error and missing data<a class="anchor" aria-label="anchor" href="#poisson-regression-with-classical-error-and-missing-data"></a>
</h2>
<table class="table">
<colgroup>
<col width="21%">
<col width="19%">
<col width="16%">
<col width="19%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th align="left">Error types</th>
<th align="left">Likelihood</th>
<th align="left">Response</th>
<th align="left">Covariate with error</th>
<th align="left">Other covariate(s)</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">Classical, missing</td>
<td align="left">Poisson</td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math></td>
<td align="left"><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math></td>
</tr></tbody>
</table>
<p>Here we show how to fit a Poisson regression model, where the model
of interest has a random intercept term.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nn</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span><span class="va">z</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Error</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generating missing data, depending on z</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="va">z</span></span>
<span><span class="va">prob_missing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">missing_index</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fl">1</span>, <span class="va">prob_missing</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Proportion missing:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">)</span><span class="op">/</span><span class="va">nn</span></span>
<span><span class="co">#&gt; [1] 0.393</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Replace the values in w by missing in case the index for missingness is =1:</span></span>
<span><span class="va">w</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">missing_index</span><span class="op">==</span><span class="fl">1</span>, <span class="cn">NA</span>, <span class="va">w</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Random effect to include in the regression model:</span></span>
<span><span class="va">re</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nn</span><span class="op">/</span><span class="fl">20</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Linear predictor</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span>  <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="va">re</span>  </span>
<span></span>
<span><span class="co"># Generate Poisson response</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="va">nn</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">data_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, z <span class="op">=</span> <span class="va">z</span>, y <span class="op">=</span> <span class="va">y</span>, w <span class="op">=</span> <span class="va">w</span>, id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Simple regression models with correct and error-prone variables to
check the effect:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glmer</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_pois</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu">glmer</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span><span class="op">|</span><span class="va">id</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">data_pois</span>, family<span class="op">=</span><span class="st">"poisson"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">coef</span></span></code></pre></div>
<p>Modeling error and missing data:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_pois</span>,</span>
<span>                       formula_moi <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">w</span> <span class="op">+</span> <span class="va">z</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/INLA/man/f.html" class="external-link">f</a></span><span class="op">(</span><span class="va">id</span>,model<span class="op">=</span><span class="st">"iid"</span><span class="op">)</span>,</span>
<span>                       formula_imp <span class="op">=</span> <span class="va">w</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       formula_mis <span class="op">=</span> <span class="va">m</span> <span class="op">~</span> <span class="va">z</span>,</span>
<span>                       family_moi <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>                       error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"classical"</span>,<span class="st">"missing"</span><span class="op">)</span>,</span>
<span>                       prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                       prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                       initial.prec.classical <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model_pois</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model_pois</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emma Skarstein, Stefanie Muff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
