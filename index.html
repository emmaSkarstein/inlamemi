<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Missing Data and Measurement Error Modelling in INLA • inlamemi</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Missing Data and Measurement Error Modelling in INLA">
<meta name="description" content="Facilitates fitting measurement error and missing data imputation models using integrated nested Laplace approximations, according to the method described in Skarstein, Martino and Muff (2023) &lt;doi:10.1002/bimj.202300078&gt;. See Skarstein and Muff (2024) &lt;doi:10.48550/arXiv.2406.08172&gt; for details on using the package.">
<meta property="og:description" content="Facilitates fitting measurement error and missing data imputation models using integrated nested Laplace approximations, according to the method described in Skarstein, Martino and Muff (2023) &lt;doi:10.1002/bimj.202300078&gt;. See Skarstein and Muff (2024) &lt;doi:10.48550/arXiv.2406.08172&gt; for details on using the package.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">inlamemi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/building_models_without_inlamemi.html">How to avoid using inlamemi</a></li>
    <li><a class="dropdown-item" href="articles/Framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a></li>
    <li><a class="dropdown-item" href="articles/modifying_default_plot.html">Modifying the default plot</a></li>
    <li><a class="dropdown-item" href="articles/multiple_error_variables.html">Multiple variables with measurement error and missingness</a></li>
    <li><a class="dropdown-item" href="articles/nhanes_survival_model.html">Survival model with repeated systolic blood pressure measurements</a></li>
    <li><a class="dropdown-item" href="articles/simulated_examples.html">Simulated examples</a></li>
    <li><a class="dropdown-item" href="articles/Visualize_model_structure.html">How are the models structured?</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/emmaSkarstein/inlamemi/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="inlamemi-">inlamemi <img src="reference/figures/inlamemi_transparent.png" align="right" height="200" style="float:right; height:200px;"><a class="anchor" aria-label="anchor" href="#inlamemi-"></a>
</h1></div>
<p>Fitting measurement error models and missing data imputation models in INLA is not trivial, and requires several workarounds in order to fit the model. At the same time, a Bayesian hierarchical framework is very attractive for modeling these types of data, since the hierarchical model structure allows us to describe how the data were collected, and any errors they may have, through the model specification. By supplying informative priors, we may be able to adjust for biases due to these errors, and propagate any uncertainty they cause. Until recently, it has been complicated to implement these kinds of models in R-INLA. This package provides a helpful interface that makes measurement error and missing data modelling in R-INLA much more feasible.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the package directly from CRAN with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"inlamemi"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, you can install the development version of inlamemi from <a href="https://github.com/" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"emmaSkarstein/inlamemi"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="when-should-i-use-this-package">When should I use this package?<a class="anchor" aria-label="anchor" href="#when-should-i-use-this-package"></a>
</h2>
<p>This package is designed for fitting models where you have one covariate that has classical measurement error, Berkson measurement error, missing observations, or any combination of these three. That could mean that you only have missing data, and if so this package can do missing data imputation.</p>
<p>The model itself must be of the class of models that is possible to fit with R-INLA. That means that it can be used for most common regression types, like linear regression and logistic regression, and you can include as many error free covariates as needed. You can also include random effects, the same way as you would normally include such effects in R-INLA. Interaction effects with the error prone variable are also dealt with by the package. It is even possible to fit models for cases where you have multiple variables with error or missingness, though this is something one should be careful with, as these models rely very heavily on the priors you give them.</p>
</div>
<div class="section level2">
<h2 id="overview-of-examples">Overview of examples<a class="anchor" aria-label="anchor" href="#overview-of-examples"></a>
</h2>
<p>Examples of how to use the package can be found in the vignettes.</p>
<table class="table">
<colgroup>
<col width="30%">
<col width="6%">
<col width="6%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th align="left">Vignette name</th>
<th align="left">Likelihood for MOI</th>
<th align="left">Error type</th>
<th align="left">Other features</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/framingham_heart_study.html">Influence of systolic blood pressure on coronary heart disease</a></td>
<td align="left">Binomial</td>
<td align="left">Classical</td>
<td align="left">Repeated measurements of error prone variable, interaction effect with error variable</td>
</tr>
<tr class="even">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/nhanes_survival_model.html">Survival model with repeated systolic blood pressure measurements</a></td>
<td align="left">Weibull survival</td>
<td align="left">Classical, missing</td>
<td align="left">Repeated measurements of error prone variable</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/simulated_examples.html">Simulated examples (multiple examples)</a></td>
<td align="left">Gaussian, Binomial, Poisson</td>
<td align="left">Berkson, classical, missing</td>
<td align="left">Random effect(s) in the model of interest, interaction effects</td>
</tr>
<tr class="even">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/multiple_error_variables.html">Multiple variables with measurement error and missingness</a></td>
<td align="left">Gaussian</td>
<td align="left">Classical</td>
<td align="left">Multiple mismeasured covariates</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/modifying_default_plot.html">Modifying the default plot</a></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">Shows how to modify the plot produced by the <code>plot.inlamemi</code> function.</td>
</tr>
<tr class="even">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/visualize_model_structure.html">How are the models structured?</a></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">A deep dive into how the data is structured in order to correctly fit the model.</td>
</tr>
<tr class="odd">
<td align="left"><a href="https://emmaskarstein.github.io/inlamemi/articles/building_models_without_inlamemi.html">How to avoid using <code>inlamemi</code></a></td>
<td align="left"></td>
<td align="left"></td>
<td align="left">An illustration of how the models can be fit without using <code>inlamemi</code>, in case you would like to extend the model in a way beyond what <code>inlamemi</code> will allow. This vignette can also be useful if you are familiar with R-INLA and want to understand how the models are structured.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="quick-guide-how-can-i-use-this-package">Quick guide: How can I use this package?<a class="anchor" aria-label="anchor" href="#quick-guide-how-can-i-use-this-package"></a>
</h2>
<p>The dataset <code>simple_data</code> is included in the package, and is a very simple simulated data set, used to illustrate the package. In this data set, we have a response variable <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>, an error free covariate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>, and a covariate that is observed with classical error, Berkson error and missingness, called <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>. We wish to fit the model</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><msub><mi>β</mi><mn>0</mn></msub><mo>+</mo><msub><mi>β</mi><mi>x</mi></msub><mi>x</mi><mo>+</mo><msub><mi>β</mi><mi>z</mi></msub><mi>z</mi><mo>+</mo><mi>ε</mi><mspace width="0.222em"></mspace><mo>,</mo></mrow><annotation encoding="application/x-tex">
 y = \beta_0 + \beta_x x + \beta_z z + \varepsilon \ ,
</annotation></semantics></math></p>
<p>but adjusting for all the errors in <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>.</p>
<p>First load the package:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emmaskarstein.github.io/inlamemi/">inlamemi</a></span><span class="op">)</span></span></code></pre></div>
<p>Next, we need to specify the formula for the main model and the formula for the imputation model. This is done in the standard way in <em>R</em>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">main_formula</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span></span></code></pre></div>
<p>For the imputation model, we take advantage of any correlation between <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math> and the error free covariate <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>, so the imputation model will be</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi><mo>=</mo><msub><mi>α</mi><mn>0</mn></msub><mo>+</mo><msub><mi>α</mi><mi>z</mi></msub><mi>z</mi><mo>+</mo><msub><mi>ε</mi><mi>x</mi></msub><mspace width="0.222em"></mspace><mi>.</mi></mrow><annotation encoding="application/x-tex">
 x = \alpha_0 + \alpha_z z + \varepsilon_x \ .
</annotation></semantics></math></p>
<p>We write that as</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">imputation_formula</span> <span class="op">&lt;-</span> <span class="va">x</span> <span class="op">~</span> <span class="va">z</span></span></code></pre></div>
<p>When adjusting for measurement error, we are completely dependent on having some information about the measurement error variances <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><msub><mi>u</mi><mi>c</mi></msub><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{u_c}^2</annotation></semantics></math> (for the classical error) and <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msubsup><mi>σ</mi><msub><mi>u</mi><mi>b</mi></msub><mn>2</mn></msubsup><annotation encoding="application/x-tex">\sigma_{u_b}^2</annotation></semantics></math> (for the Berkson error), since the size of this variance will affect how the estimates are biased. We can gain information about these variances in a few different ways, if repeated measurements have been made then these can be put directly into the model to estimate the error variance, or if we have some expert knowledge about the error size, then that can be used to specify an informative prior for the variance (or precision, since in INLA the precision is used, rather than the variance).</p>
<p>In this case, since we have in fact simulated the data ourselves, we know that the error variances are in both cases close to 1, so we specify priors that have modes at 1.</p>
<p>In the <code>fit_inlamemi</code> function we also need to specify the likelihood for the model of interest, which in this case is Gaussian.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simple_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/fit_inlamemi.html">fit_inlamemi</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">simple_data</span>, </span>
<span>                           formula_moi <span class="op">=</span> <span class="va">main_formula</span>, </span>
<span>                           formula_imp <span class="op">=</span> <span class="va">imputation_formula</span>, </span>
<span>                           family_moi <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                           error_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"berkson"</span>, <span class="st">"classical"</span>, <span class="st">"missing"</span><span class="op">)</span>,</span>
<span>                           prior.prec.moi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                           prior.prec.berkson <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>, </span>
<span>                           prior.prec.classical <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                           prior.prec.imp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">9</span><span class="op">)</span>,</span>
<span>                           prior.beta.error <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>,</span>
<span>                           initial.prec.moi <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           initial.prec.berkson <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           initial.prec.classical <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           initial.prec.imp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>Once we have fit the model, we can view the summary:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span>
<span><span class="co">#&gt; Formula for model of interest: </span></span>
<span><span class="co">#&gt; y ~ x + z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula for imputation model: </span></span>
<span><span class="co">#&gt; x ~ z</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Error types: </span></span>
<span><span class="co">#&gt; [1] "berkson"   "classical" "missing"  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for model of interest: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.0 1.029734 0.2192649   0.611786 1.027337   1.441360 1.023829</span></span>
<span><span class="co">#&gt; beta.z 1.910320 0.3888428   1.225565 1.899260   2.569838 1.909285</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficient for variable with measurement error and/or missingness: </span></span>
<span><span class="co">#&gt;            mean        sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; beta.x 1.973047 0.2044895   1.566493 1.974404   2.371636 1.980101</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fixed effects for imputation model: </span></span>
<span><span class="co">#&gt;               mean         sd 0.025quant 0.5quant 0.975quant     mode</span></span>
<span><span class="co">#&gt; alpha.x.0 1.033082 0.05058036  0.9338513 1.033090   1.132266 1.033090</span></span>
<span><span class="co">#&gt; alpha.x.z 2.024703 0.05224236  1.9222875 2.024685   2.127221 2.024685</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Model hyperparameters (apart from beta.x): </span></span>
<span><span class="co">#&gt;                                      mean        sd 0.025quant  0.5quant</span></span>
<span><span class="co">#&gt; Precision for model of interest 1.1284762 0.3651824  0.5643224 1.0775830</span></span>
<span><span class="co">#&gt; Precision for x berkson model   1.1270935 0.3502996  0.5871622 1.0778489</span></span>
<span><span class="co">#&gt; Precision for x classical model 0.9274713 0.1107587  0.7291709 0.9207291</span></span>
<span><span class="co">#&gt; Precision for x imp model       0.9771797 0.1269574  0.7504628 0.9692680</span></span>
<span><span class="co">#&gt;                                 0.975quant      mode</span></span>
<span><span class="co">#&gt; Precision for model of interest   1.985783 0.9838628</span></span>
<span><span class="co">#&gt; Precision for x berkson model     1.952024 0.9863724</span></span>
<span><span class="co">#&gt; Precision for x classical model   1.164627 0.9070096</span></span>
<span><span class="co">#&gt; Precision for x imp model         1.249446 0.9540553</span></span></code></pre></div>
<p>And we can use the default plot function to see a plot of the fixed effects and estimated coefficient for the variable with error:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">simple_model</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-7-1.png" width="100%"></p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=inlamemi" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/emmaSkarstein/inlamemi/" class="external-link">Browse source code</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing inlamemi</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Emma Skarstein <br><small class="roles"> Maintainer, author, copyright holder </small> <a href="https://orcid.org/0000-0002-6347-855X" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Stefanie Muff <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0002-8425-0757" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Emma Skarstein, Stefanie Muff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
